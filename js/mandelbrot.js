// Generated by CoffeeScript 1.4.0
(function(){window.require(["jquery","libs/modernizr-2.5.3-respond-1.1.0.min","script","libs/knockout-2.1.0.debug","mandelbrot-core","color-converter","mandelbrot-colors"],function(e,t,n,r,i,s,o){"strict mode";var u,a,f,l,c,h,p,d;u=function(){function n(n,r,i){var s,o,u=this;this.mandelbrotCore=n;this.mandelbrotColors=r;if(this.mandelbrotCore==null)throw"mandelbrotCore is required";if(this.mandelbrotColors==null)throw"mandelbrotColors is required";if(i==null)throw"A canvas element is required";this.box={top:1,left:-2,bottom:-1,right:1};s=i.getContext("2d");if(s==null)throw"Could not build 2d canvas context in canvas";t(i,s);if(window.Modernizr.webworkers&&window.JSON){o=new window.Worker("js/mandelbrot-worker.js");this.drawSet=function(){var e;e=JSON.stringify({message:"run",width:s.canvas.width,height:s.canvas.height,box:u.box,maxIterations:30});o.addEventListener("message",function(e){var t,n;t=JSON.parse(e.data);switch(t.message){case"progress":n=document.createEvent("Event");n.initEvent("progress",!0,!0);n.data=e.data;return document.dispatchEvent(n);case"success":return u.mandelbrotColors.drawEscapeTimesInContext(t.value,s)}},!1);return o.postMessage(e)}}else this.drawSet=function(){var e;e=u.mandelbrotCore.getEscapeTimes(s.canvas.width,s.canvas.height,u.box,30);return u.mandelbrotColors.drawEscapeTimesInContext(e,s)};e(window).resize(function(){var e;clearTimeout(e);e=setTimeout(function(){return t(i,s,u.mandelbrotColors.cachedImage)},100)})}var t;t=function(t,n,r){var i,s;s=e(t).parent().width();i=s*2/3;n.canvas.width=s;n.canvas.height=i;r!=null&&n.drawImage(r,0,0,s,i)};return n}();a=function(){var e=this;this.maxIterations=r.observable(30);this.loopColorsEvery=r.observable(30);this.progress=r.observable(0);this.inProgress=r.computed(function(){return e.progress()<100});return this};d=new a;h=new i;l=new s;c=new o(l,d.maxIterations,d.loopColorsEvery);f=document.getElementById("mandelbrot");p=new u(h,c,f);d.drawSet=p.drawSet;d.viewAsImage=function(){return window.location=c.cachedImage.src};r.applyBindings(d);document.addEventListener("progress",function(e){var t;t=JSON.parse(e.data);return d.progress(Math.floor(t.value))},!1);p.drawSet()})}).call(this);